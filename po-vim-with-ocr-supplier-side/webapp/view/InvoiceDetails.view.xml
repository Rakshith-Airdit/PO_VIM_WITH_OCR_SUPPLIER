<mvc:View
    controllerName="com.povimwithocrsupplier.povimwithocrsupplierside.controller.InvoiceDetails"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:m="sap.m"
    xmlns:f="sap.f"
    xmlns:form="sap.ui.layout.form"
    xmlns:u="sap.ui.unified"
    xmlns="sap.uxap"
    xmlns:l="sap.ui.layout"
>
    <l:Splitter width="100%">
        <ObjectPageLayout
            id="idObjectPageLayout"
            showTitleInHeaderContent="true"
            alwaysShowContentHeader="false"
            preserveHeaderStateOnScroll="false"
            headerContentPinnable="true"
            headerContentPinned="false"
            toggleHeaderOnTitleClick="true"
            showFooter="true"
            isChildPage="true"
            upperCaseAnchorBar="false"
        >
            <layoutData>
                <l:SplitterLayoutData
                    id="splitterSize"
                    size="100%"
                />
            </layoutData>

            <headerTitle>
                <ObjectPageDynamicHeaderTitle>
                    <breadcrumbs>
                        <m:Breadcrumbs
                            id="breadcrumbsId"
                            currentLocationText="Invoice Details"
                        >
                            <m:Link
                                text="PO Based Invoice List"
                                press="handleClose"
                            />
                        </m:Breadcrumbs>
                    </breadcrumbs>
                    <expandedHeading>
                        <m:Title
                            text="{oHeaderModel>/results/0/INVOICE_NO}"
                            wrapping="true"
                        />
                    </expandedHeading>
                    <snappedHeading>
                        <m:HBox
                            wrap="NoWrap"
                            alignItems="Center"
                        >
                            <m:Avatar
                                src="./Images/objPageIcon.png"
                                displaySize="S"
                                displayShape="Square"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:VBox wrap="Wrap">
                                <m:Title
                                    text="{oHeaderModel>/results/0/INVOICE_NO}"
                                    wrapping="true"
                                />
                                <m:Label
                                    text="INV NO:"
                                    wrapping="true"
                                />
                            </m:VBox>
                        </m:HBox>
                    </snappedHeading>
                    <actions>
                        <m:Button
                            icon="sap-icon://edit"
                            text="Edit"
                            type="Default"
                            visible="{= ${oHeaderModel>/results/0/STATUS_DESC} === 'Rejected' }"
                            enabled="{= !${oEditStateModel>/isEditMode} }"
                            press="onPressEdit"
                        />
                    </actions>
                </ObjectPageDynamicHeaderTitle>
            </headerTitle>

            <headerContent>
                <m:FlexBox
                    wrap="Wrap"
                    fitContainer="true"
                    alignItems="Stretch"
                >
                    <m:Avatar
                        src="./Images/objPageIcon.png"
                        displaySize="L"
                        displayShape="Square"
                        class="sapUiMediumMarginEnd"
                    />
                    <m:VBox class="sapUiSmallMarginEnd sapUiSmallMarginBottom">
                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Purchase Order:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text
                                text="{oHeaderModel>/results/0/PO_NUMBER}"
                            />
                        </m:HBox>

                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Invoice Date:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text
                                text="{oHeaderModel>/results/0/INVOICE_DATE}"
                            />
                        </m:HBox>

                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Order Amount:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:ObjectNumber
                                number="{oHeaderModel>/results/0/INVOICE_AMOUNT}"
                                unit="INR"
                            />
                        </m:HBox>
                    </m:VBox>

                    <!-- SECOND COLUMN -->
                    <m:VBox class="sapUiSmallMarginEnd sapUiSmallMarginBottom">
                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Bank Name:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text
                                text="{oOCRHeaderModel>/results/0/bank_name}"
                            />
                        </m:HBox>

                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Company Code:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text text="{oOCRHeaderModel>/results/0/Bukrs}" />
                        </m:HBox>

                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Downpayment amount:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text text="{oOCRHeaderModel>/results/0/Dpamt}" />
                        </m:HBox>
                    </m:VBox>

                    <!-- THRID COLUMN: Bank Details -->
                    <!-- visible="{= ${oHeaderModel>/results/0/SES_STATUS} === 'Approved'}" -->

                    <m:VBox class="sapUiSmallMarginEnd sapUiSmallMarginBottom">
                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Purchase Group:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text text="{oOCRHeaderModel>/results/0/Ekgrp}" />
                        </m:HBox>

                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Bank Account No:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:Text
                                text="{oOCRHeaderModel>/results/0/bank_acc}"
                            />
                        </m:HBox>

                        <m:HBox class="sapUiTinyMarginBottom">
                            <m:Label
                                text="Status:"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:ObjectStatus
                                id="invoiceStatus"
                                text="{oHeaderModel>/results/0/STATUS_DESC}"
                                inverted="true"
                                state="{path: 'oHeaderModel>/results/0/STATUS_DESC', formatter: '.formatStatusState'}"
                            />
                        </m:HBox>
                    </m:VBox>
                </m:FlexBox>
            </headerContent>

            <sections>
                <ObjectPageSection
                    title="Item Deatils"
                    titleUppercase="false"
                >
                    <subSections>
                        <ObjectPageSubSection>
                            <blocks>
                                <m:VBox>
                                    <!-- Scrollable Table Container -->
                                    <m:ScrollContainer
                                        horizontal="true"
                                        vertical="true"
                                        width="100%"
                                        visible="{= ${oItemsModel>/results}.length > 0 }"
                                    >
                                        <m:Table
                                            xmlns:m="sap.m"
                                            id="myTable"
                                            items="{oItemsModel>/results}"
                                            inset="false"
                                            width="auto"
                                            noDataText="No Items Extracted by Coder Yet!!"
                                        >
                                            <m:headerToolbar>
                                                <m:Toolbar>
                                                    <m:Title
                                                        text="Item Details"
                                                        level="H2"
                                                    />
                                                </m:Toolbar>
                                            </m:headerToolbar>

                                            <m:columns>
                                                <m:Column width="auto">
                                                    <m:Text text="Sr No" />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Material Description"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Description"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text text="UOM" />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text text="Unit Rate" />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Total Price"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Ordered Quantity"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="GRN Quantity"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Invoice Quantity"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Invoiced Price"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Qty Match Status"
                                                    />
                                                </m:Column>
                                                <m:Column width="auto">
                                                    <m:Text
                                                        text="Price Match Status"
                                                    />
                                                </m:Column>
                                            </m:columns>

                                            <m:items>
                                                <m:ColumnListItem>
                                                    <m:cells>
                                                        <m:Text
                                                            text="{oItemsModel>SR_NO}"
                                                        />
                                                        <m:Text
                                                            text="{oItemsModel>MATERIAL_NO}"
                                                        />
                                                        <m:Text
                                                            text="{oItemsModel>MATERIAL_DESCRIPTION}"
                                                        />
                                                        <m:Text
                                                            text="{oItemsModel>UNITS_OF_MEASURE}"
                                                        />
                                                        <m:Text
                                                            text="{oItemsModel>UNIT_RATE}"
                                                        />
                                                        <m:ObjectNumber
                                                            number="{oItemsModel>TOTAL_PRICE}"
                                                            unit="INR"
                                                        />
                                                        <m:Text
                                                            text="{oItemsModel>ORDERED_QUANTITY}"
                                                        />
                                                        <m:Text
                                                            text="{oItemsModel>GRN_QUANTITY}"
                                                        />
                                                        <m:HBox>
                                                            <m:Input
                                                                visible="{= ${oHeaderModel>/results/0/STATUS_DESC} === 'Rejected'}"
                                                                editable="{oEditStateModel>/isEditMode}"
                                                                value="{oItemsModel>INVOICED_QUANTITY}"
                                                            />
                                                            <m:Text
                                                                visible="{= ${oHeaderModel>/results/0/STATUS_DESC} !== 'Rejected'}"
                                                                text="{oItemsModel>INVOICED_QUANTITY}"
                                                            />
                                                        </m:HBox>
                                                        <m:HBox>
                                                            <m:Input
                                                                visible="{= ${oHeaderModel>/results/0/STATUS_DESC} === 'Rejected'}"
                                                                editable="{oEditStateModel>/isEditMode}"
                                                                value="{oItemsModel>INVOICED_PRICE}"
                                                            />
                                                            <m:Text
                                                                visible="{= ${oHeaderModel>/results/0/STATUS_DESC} !== 'Rejected'}"
                                                                text="{oItemsModel>INVOICED_PRICE}"
                                                            />
                                                        </m:HBox>
                                                        <m:ObjectStatus
                                                            inverted="true"
                                                            text="{oItemsModel>QTY_MATCH_STATUS}"
                                                            state="{path: 'oItemsModel>QTY_MATCH_STATUS', formatter: '.formatQtyMatchStatus'}"
                                                        />
                                                        <m:ObjectStatus
                                                            inverted="true"
                                                            text="{oItemsModel>PRICE_MATCH_STATUS}"
                                                            state="{path: 'oItemsModel>PRICE_MATCH_STATUS', formatter: '.formatPriceMatchStatus'}"
                                                        />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </m:ScrollContainer>

                                    <!-- TOTAL at the bottom, aligned right -->
                                    <!-- <m:HBox
                                    justifyContent="End"
                                    alignItems="Center"
                                    class="sapUiSmallMarginTop sapUiSmallMarginBottom sapUiSmallMarginEnd"
                                >
                                    <m:Label
                                        text="Total Amount:"
                                        class="sapUiTinyMarginEnd"
                                    />
                                    <m:ObjectNumber
                                        number="{oItemsModel>/totalSrvSheetVal}"
                                        unit="INR"
                                    />
                                </m:HBox> -->

                                    <m:MessageStrip
                                        id="waitingStrip"
                                        text="No Items Extracted by Coder Yet!!"
                                        showIcon="true"
                                        showCloseButton="false"
                                        class="sapUiMediumMarginBottom"
                                        visible="{= ${oItemsModel>/results}.length === 0 }"
                                    />
                                </m:VBox>
                            </blocks>
                        </ObjectPageSubSection>
                    </subSections>
                </ObjectPageSection>

                <ObjectPageSection
                    title="Attachments"
                    titleUppercase="false"
                >
                    <subSections>
                        <ObjectPageSubSection>
                            <blocks>
                                <m:Panel class="sapUiNoContentPadding">
                                    <m:VBox
                                        class="sapUiSmallMargin sapUiSmallMarginTop sapUiSmallMarginBottom"
                                    >
                                        <!-- Attachments Header -->
                                        <m:HBox
                                            justifyContent="SpaceBetween"
                                            alignItems="Center"
                                            class="sapUiTinyMarginBottom"
                                        >
                                            <!-- Attachments count title -->
                                            <m:Title
                                                text="Attachments"
                                                level="H3"
                                                id="attachmentsCountTitle"
                                            />
                                        </m:HBox>

                                        <!-- Attachments List -->
                                        <m:List
                                            id="attachmentsList"
                                            items="{oAttachmentsModel>/attachments}"
                                            inset="false"
                                            noDataText="No attachments uploaded."
                                            class="sapUiNoMargin"
                                        >
                                            <m:CustomListItem>
                                                <m:HBox
                                                    justifyContent="SpaceBetween"
                                                    alignItems="Center"
                                                    class="sapUiSmallMargin"
                                                >
                                                    <!-- LEFT SIDE: Icon + Attachment Details -->
                                                    <m:HBox alignItems="Center">
                                                        <core:Icon
                                                            src="sap-icon://document-text"
                                                            size="2rem"
                                                            class="sapUiSmallMarginEnd"
                                                        />
                                                        <m:VBox>
                                                            <m:Text
                                                                text="{oAttachmentsModel>REQUEST_NO}"
                                                                class="sapUiTinyMarginBottom"
                                                            />
                                                            <m:Text
                                                                text="{oAttachmentsModel>DESCRIPTION}"
                                                                class="fileStatus"
                                                            />
                                                        </m:VBox>
                                                    </m:HBox>

                                                    <!-- RIGHT SIDE: Edit & Delete Buttons -->
                                                    <m:HBox alignItems="Center">
                                                        <m:Button
                                                            icon="sap-icon://show"
                                                            type="Transparent"
                                                            tooltip="Preview Attachment"
                                                            press="onPreviewPdf"
                                                            class="sapUiTinyMarginEnd"
                                                        >
                                                            <m:customData>
                                                                <core:CustomData
                                                                    key="imageUrl"
                                                                    value="{oAttachmentsModel>IMAGEURL}"
                                                                    writeToDom="false"
                                                                />
                                                            </m:customData>
                                                        </m:Button>
                                                    </m:HBox>
                                                </m:HBox>
                                            </m:CustomListItem>
                                        </m:List>
                                    </m:VBox>
                                </m:Panel>

                                <!-- File Uploader Dialog -->
                            </blocks>
                        </ObjectPageSubSection>
                    </subSections>
                </ObjectPageSection>

                <ObjectPageSection
                    title="Comments"
                    titleUppercase="false"
                    visible="{= (${oHeaderModel>/results/0/STATUS_DESC} === 'Approved' || ${oHeaderModel>/results/0/STATUS_DESC} === 'Rejected') &amp;&amp; ${oCommentsModel>/comments}.length > 0 }"
                >
                    <ObjectPageSubSection>
                        <blocks>
                            <m:List
                                id="commentsList"
                                items="{oCommentsModel>/comments}"
                                inset="false"
                            >
                                <m:FeedListItem
                                    icon="sap-icon://customer"
                                    text="{oCommentsModel>Text}"
                                    sender="Comment"
                                />
                            </m:List>
                        </blocks>
                    </ObjectPageSubSection>
                </ObjectPageSection>
            </sections>

            <footer>
                <m:Toolbar id="otbFooter">
                    <m:ToolbarSpacer />
                    <m:Button
                        type="Back"
                        text="Cancel"
                        press="handleClose"
                    />
                    <m:Button
                        type="Emphasized"
                        text="Re-Submit"
                        press="onPressReSubmit"
                        visible="{= ${oHeaderModel>/results/0/STATUS_DESC} === 'Rejected'}"
                        enabled="{= ${oEditStateModel>/isEditMode} }"
                    />
                    <m:Button
                        text="Cancel Edit"
                        press="onPressCancelEdit"
                        visible="{= ${oHeaderModel>/results/0/STATUS_DESC} === 'Rejected' &amp;&amp; ${oEditStateModel>/isEditMode}}"
                        enabled="{= ${oEditStateModel>/isEditMode} }"
                    />
                    <!-- <m:Button
                    type="Success"
                    icon="sap-icon://complete"
                    text="Approve"
                    press="onPressApprove"
                    visible="{= ${oHeaderModel>/SES_STATUS}.includes('In-Process') }"
                />
                <m:Button
                    type="Reject"
                    icon="sap-icon://decline"
                    text="Reject"
                    press="onPressReject"
                    visible="{= ${oHeaderModel>/SES_STATUS}.includes('In-Process') }"
                /> -->
                </m:Toolbar>
            </footer>
        </ObjectPageLayout>

        <f:DynamicPage
            showFooter="true"
            id="rightPaneLayout"
        >
            <f:title>
                <f:DynamicPageTitle>
                    <f:heading>
                        <m:Title text="Invoice PDF" />
                    </f:heading>
                    <f:actions>
                        <m:Button
                            id="closePdfButton"
                            icon="sap-icon://decline"
                            text="Close PDF"
                            press="onClosePdf"
                            type="Transparent"
                            visible="{= ${/isPdfVisible}}"
                        />
                    </f:actions>
                </f:DynamicPageTitle>
            </f:title>
            <f:content>
                <core:HTML
                    content='&lt;iframe id="pdfFrame" width="100%" height="700px" style="border:none;"&gt;&lt;/iframe&gt;'
                />
            </f:content>
        </f:DynamicPage>
    </l:Splitter>
</mvc:View>
